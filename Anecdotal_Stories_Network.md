"-------------------------------------------------"

            极客时间 刘超 《趣谈网络协议》
    
"-------------------------------------------------"

"""第一讲| 为什么要学习网络协议"""

    1、协议三要素：
        
        语法：就是这段内容要符合一定的规则和格式。
                
        语义：就是这段内容要代表某种意义。
        
        顺序：就是先干啥，后干啥。
        
    2、关于域名系统 DNS (Domain Name System)
    
        从域名中解析 ip 地址
        
        DNS 主要由 3 部分组成：
            
            a. 域名解析器(resolver)
            b. 域名空间(domain name space)
            c. 名称服务器(name server)
            
        DNS 服务器获取域名空间的部分信息的方法：
        
            a. 由管理员编辑一个原始区域文件;
            b. 从其他名称服务器哪里复制区域文件;    
            c. 通过向其他DNS服务器查询来获取具有一定时效的缓存信息。
        
        名称服务器的3中主要类型：
        
            a. 主名称服务器：拥有一个区域文件的原始版本的服务器。
            
            b. 次名称服务器：从其他主名称服务器那里复制一个区域文件。是一个只读版本。
                次名称服务器通过区域传输跟随主名称服务器上的区域文件进行变化。
            
            c. 惟高速缓存名称服务器：没有区域文件。它的职责是帮助名称解析器完成名称解析，
                并缓存解析结果，便于以后使用。        
    
    3、域名解析:
    
        TCP/IP 的域名系统是一个有效的、可靠的、通用的、分布式的 名称-地址 映射系统。
        
        域名解析有两种方式：正向解析和反向解析。
            正向解析：根据域名查找对应的IP地址或其他相关信息。
            反向解析：根据主机的IP地址查询其相关信息。    
        
    4、查询域名 && 域名解析：
    
        DNS 查找：
            浏览器查找域名的 IP 地址
            浏览器 DNS 查找顺序一般是这样的：
            浏览器缓存--> 系统缓存 --> 路由器缓存 --> ISP DNS 缓存 --> 递归搜索。
        
        详细过程如下：
                
            a. 浏览器缓存，浏览器会缓存DNS记录一段时间。
                
                操作系统没有设定浏览器存储DNS记录的时间长短，
                不同的浏览器会存储各自的一个固定时间，时长为2~30分钟不等。         
            
            b. 系统缓存。
                
                如果浏览器缓存里面没有找到需要的记录，浏览器会做一个操作系统调用
                (windows 里面是 gethostname),这样就可以获得系统缓存里面的记录。
                
            c. 路由器缓存：
            
                接下来，如果还是没有找到需要的缓存，将前面的查询请求发个路由器，
                它一般会有自己的DNS缓存。
                
            d. 如果还没有，那就去检查 ISP：
                
                每个ISP(网络服务提供商)，都会有自己的本地域名服务器，它会在 URL 第一次
                访问时缓存该域名的指向。下次再访问时，他会从缓存中把这个URL 曾经指向的 IP 调出来。
                
            e. 递归搜索：
            
                如果ISP本地缓存中还没有
                你的ISP的DNS服务器会从根域名开始进行递归查询。        
            
                递归查询：主机向本地域名服务器的查询一般都是采用递归查询。                
                迭代查询：本地域名服务器向根域名服务器的查询通常是采用迭代查询。
                
                举个栗子：假设的主机想知道另一个主机（域名为 my.xxsilence.net)的IP地址。
                具体步骤如下：
                
                    ① 主机先向其本地域名服务器进行递归查询，如果缓存中没有，继续下一步。
                    ② 本地域名服务器采用迭代查询，先向一个根域名服务器查询。           
                    ③ 根域名服务器告诉本地域名服务器，下一次查询的顶级域名服务器 dns.net。                   
                    ④ 本地域名服务器向顶级域名服务器 dns.net。                  
                    ⑤ 顶级域名服务器 dns.net，下一次应查询的权限域名服务器dns.xxsilence.net的IP地址。                    
                    ⑥ 本地域名服务器向权限域名服务器dns.xxsilence.net进行查询。                 
                    ⑦ 权限域名服务器dns.xxsilence.net告诉本地域名服务器，所查询的主机的IP地址。                
                    ⑧ 本地域名服务器最后把查询结果告诉主机。

    5、互联网在世界运行中，都使用了那些协议：
    
        你在浏览器中里面输入 Https://www.kaola.com， 这是个 URL。
        浏览器只知道名字是“www.kaola.com”,但是不知道具体的地点，所以不知道该如何访问。
        于是，它打开地址簿去查找。可以使用一般地址薄协议DNS去查找，还可以使用另一种更
        精准的地址薄去查找协议HTTPDNS。
        
        无论使用哪种方法查找，最终都会得到这个地址：106.114.138.24 这是个地址，是互联网
        世界的“门牌号”。
        
        知道了目标地址，浏览器就开始打包它的请求。对于普通的浏览器请求，往往会使用 HTTP 协议；
        但是对于购物的请求，往往需要进行加密传输，因而会使用 HTTPS 协议。无论是什么协议，里面
        都会写明“你要买什么和买了多少”。
        
                ------------------------------------
                HTTP头:  POST,URL,HTTP 1.1, 
                         正文格式：json, 正文长度: 1234
                -------------------------------------
                         我要买什么，买多少
                -------------------------------------         
                              
        DNS、HTTP、HTTPS 所在的层我们成为应用层。经过应用层封装后，
        浏览器会将应用层的包交给下一层取完成，通过 socket 编程来实现。
        
        下一层是 传输层。传输层有两种协议，一种是无连接的协议 UDP，一种是面向连接的协议 TCP。
        所谓的面向连接就是，TCP 会保证这包能够到达目的地。如果不能到达，就会重新发送，直到到达。
        
        TCP 协议里面会有两个端口，一个是浏览器监听的端口，一个是电商服务器监听的端口。操作系统
        往往通过端口来判断，它得到的包应该给那个进程。
                
                -----------------------------------
                TCP头：   浏览器端口：12345
                          电商应用端口：443
                ------------------------------------
                HTTP头:  POST,URL,HTTP 1.1, 
                         正文格式：json, 正文长度: 1234
                -------------------------------------
                         我要买什么，买多少
                -------------------------------------
                
        传输层封装完毕后，浏览器会将包交给操作系统的网络层。网络层的协议是 IP 协议。
        在 IP 协议里会有源 IP 地址，即浏览器所在机器的 IP 地址和目标 IP 地址，也即
        电商网站所在服务器的 IP 地址。
        
                ---------------------------------------
                IP 头：   客户端电脑IP: 192.168.1.101
                          电商服务器IP: 106.114.138.24
                ---------------------------------------
                TCP头：   浏览器端口：12345
                          电商应用端口：443
                ---------------------------------------
                HTTP头:  POST,URL,HTTP 1.1, 
                         正文格式：json, 正文长度: 1234
                ---------------------------------------
                         我要买什么，买多少
                ---------------------------------------
                
        操作系统既然知道了目标 IP 地址，就开始想如何根据这个门牌号找到目标机器。
        操作系统往往会判断，这个目标 IP 地址是本地人，还是外地人。从门牌号就可以开出来。
        但是，显然电商网站不是本地，而是在遥远的远方。
        
        操作系统知道要离开本地去远方，虽然不知道远方在何处，但是可以这样类比一下：
        如果去国外要去海关，去外地就要去网关。而操作系统启动的时候，就会被 DHCP 协议
        配置 IP 地址，以及默认的网关的 IP 地址 192.168.1.1
        
        操作系统如何将 IP 地址发给网关呢？在本地通信基本靠吼，于是操作系统会大吼一声，
        谁是 192.168.1.1啊 ?，网关就会答应它，我就是，我的本地地址在村东头。
        这个本地地址就是 MAC 地址，而大吼的那一声是 ARP 协议。
        
                
                MAC 头：  客户端电脑MAC: 192.168.1.101 的MAC
                          网关的MAC: 102.168.1.1 的MAC
                ---------------------------------------
                IP 头：   客户端电脑IP: 192.168.1.101
                          电商服务器IP: 106.114.138.24
                ---------------------------------------
                TCP头：   浏览器端口：12345
                          电商应用端口：443
                ---------------------------------------
                HTTP头:  POST,URL,HTTP 1.1, 
                         正文格式：json, 正文长度: 1234
                ---------------------------------------
                         我要买什么，买多少
                ---------------------------------------
        
        于是操作系统将 IP 包交个了下一层，也就是 MAC 层。网卡
        再将包发出去，由于这个包里面是有 MAC 地址的，因而它能够到达网关。
        
        网关收到包之后，会根据自己的知识，判断下一步应该怎么走，网关往往
        是一个路由器，到某个 IP 地址应该怎么走，这个叫做路由表。
        
        路由器有点像玄奘西行路上的一个个国家的一个个城关。每个城关都连着两个国家，
        每个国家相当于一个局域网，在每个国家内部，都可以使用本地的地址 MAC 进行通信。
        
        一旦跨过网关，就需要拿出 IP 头来，里面写着贫僧来自东土大唐（就是源IP地址），
        欲往西天求经(目的IP地址)。路过宝地，借宿一晚，请问接下来该怎么走？
        
        城关往往直到这些“知识的”，因为城关和临近的城关也会经常沟通，到哪里应该怎么走，
        这种沟通的协议就是“路由协议”，常用的有 OSPF 和 BGP。
        
        
        
        





"""第二讲| 网络分层的真实含义是什么"""

"""第三讲| ifconfig: 熟悉又陌生的命令行"""

"""第四讲| DHCP 与 PXE: IP是怎么来的，又是怎么没的"""

"""第五讲| """